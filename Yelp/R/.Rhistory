test$CoverageField6A_SalesField3_SalesField5_hist = test$CoverageField6A==13 & test$SalesField3==0 & test$SalesField5==5
test$CoverageField8_Field7_PersonalField84_hist = test$CoverageField8=='T' & test$Field7==23 & test$PersonalField84==2.0
test$CoverageField8_Field7_PersonalField27_hist = test$CoverageField8=='T' & test$Field7==23 & test$PersonalField27==1
test$Field6_Field9_SalesField5_hist = test$Field6=='J' & test$Field9==0.0004 & test$SalesField5==5
test$CoverageField5A_Field7_PersonalField12_hist = test$CoverageField5A==13 & test$Field7==23 & test$PersonalField12==1
test$Field6_PersonalField13_SalesField5_hist = test$Field6=='J' & test$PersonalField13==2 & test$SalesField5==5
test$Field6_SalesField4_SalesField5_hist = test$Field6=='J' & test$SalesField4==5 & test$SalesField5==5
test$Field6_PropertyField34_SalesField5_hist = test$Field6=='J' & test$PropertyField34=='N' & test$SalesField5==5
test$CoverageField5A_PropertyField35_PropertyField37_hist = test$CoverageField5A==13 & test$PropertyField35==0 & test$PropertyField37=='N'
test$CoverageField5A_CoverageField6A_Field6_hist = test$CoverageField5A==13 & test$CoverageField6A==13 & test$Field6=='J'
test$Field6_Field9_PropertyField37_hist = test$Field6=='J' & test$Field9==0.0004 & test$PropertyField37=='N'
test$Field6_PersonalField13_PropertyField37_hist = test$Field6=='J' & test$PersonalField13==2 & test$PropertyField37=='N'
test$Field6_PersonalField82_SalesField5_hist = test$Field6=='J' & test$PersonalField82==0 & test$SalesField5==5
test$CoverageField8_PropertyField34_SalesField5_hist = test$CoverageField8=='T' & test$PropertyField34=='N' & test$SalesField5==5
test$CoverageField5A_Field9_SalesField5_hist = test$CoverageField5A==13.0 & test$Field9==0.0006 & test$SalesField5==5.0
test$CoverageField5A_Field6_PropertyField34_hist = test$CoverageField5A==13 & test$Field6=='J' & test$PropertyField34=='N'
test$Field6_PropertyField28_SalesField4_hist = test$Field6=='J' & test$PropertyField28=='B' & test$SalesField4==5
test$CoverageField8_PersonalField27_PropertyField37_hist = test$CoverageField8=='T' & test$PersonalField27==1 & test$PropertyField37=='N'
####################################################################
#filter top 1000 features#
cat('select top importance features\n')
importance_matrix = read_csv("../feature/importance_matrix_v28_hist_1_2_3.csv")
feature.names = importance_matrix$Feature
train.names = unique(c(train.names,feature.names))
test.names = unique(c(test.names,feature.names))
train = train[,train.names]
test = test[,test.names]
#######MORE HIST FEATURE#################
cat('hist 4 gram \n')
#train
train$CoverageField5A_CoverageField6A_Field7_PersonalField27_hist = train$CoverageField5A==13 & train$CoverageField6A==13 & train$Field7==23 & train$PersonalField27==1
train$CoverageField5A_CoverageField6A_Field7_PersonalField84_hist = train$CoverageField5A==13.0 & train$CoverageField6A==13.0 & train$Field7==23.0 & train$PersonalField84==2.0
train$CoverageField5A_CoverageField6A_Field7_PropertyField34_hist = train$CoverageField5A==13 & train$CoverageField6A==13 & train$Field7==23 & train$PropertyField34=='N'
train$CoverageField5A_CoverageField6A_Field7_PropertyField37_hist = train$CoverageField5A==13 & train$CoverageField6A==13 & train$Field7==23 & train$PropertyField37=='N'
train$CoverageField5A_CoverageField6A_Field7_SalesField5_hist = train$CoverageField5A==13 & train$CoverageField6A==13 & train$Field7==23 & train$SalesField5==5
train$CoverageField5A_CoverageField6A_GeographicField8A_SalesField5_hist = train$CoverageField5A==13 & train$CoverageField6A==13 & train$GeographicField8A==2 & train$SalesField5==5
train$CoverageField5A_CoverageField6A_PersonalField27_PropertyField34_hist = train$CoverageField5A==13 & train$CoverageField6A==13 & train$PersonalField27==1 & train$PropertyField34=='N'
train$CoverageField5A_CoverageField6A_PersonalField27_SalesField5_hist = train$CoverageField5A==13 & train$CoverageField6A==13 & train$PersonalField27==1 & train$SalesField5==5
train$CoverageField5A_CoverageField6A_PersonalField84_PropertyField34_hist = train$CoverageField5A==13 & train$CoverageField6A==13 & train$PersonalField84==2.0 & train$PropertyField34=='N'
train$CoverageField5A_CoverageField6A_PersonalField84_SalesField5_hist = train$CoverageField5A==13.0 & train$CoverageField6A==13.0 & train$PersonalField84==2.0 & train$SalesField5==5.0
train$CoverageField5A_CoverageField6A_PersonalField84_SalesField5_hist = train$CoverageField5A==13.0 & train$CoverageField6A==13.0 & train$PersonalField84==-1 & train$SalesField5==5.0
train$CoverageField5A_CoverageField6A_PropertyField34_PropertyField37_hist = train$CoverageField5A==13 & train$CoverageField6A==13 & train$PropertyField34=='N' & train$PropertyField37=='N'
train$CoverageField5A_CoverageField6A_PropertyField34_SalesField5_hist = train$CoverageField5A==13 & train$CoverageField6A==13 & train$PropertyField34=='N' & train$SalesField5==5
train$CoverageField5A_CoverageField6A_PropertyField37_SalesField5_hist = train$CoverageField5A==13 & train$CoverageField6A==13 & train$PropertyField37=='N' & train$SalesField5==5
train$CoverageField5A_Field7_GeographicField8A_PersonalField27_hist = train$CoverageField5A==13 & train$Field7==23 & train$GeographicField8A==2 & train$PersonalField27==1
train$CoverageField5A_Field7_GeographicField8A_PersonalField84_hist = train$CoverageField5A==13.0 & train$Field7==23.0 & train$GeographicField8A==2.0 & train$PersonalField84==2.0
train$CoverageField5A_Field7_PersonalField27_PersonalField84_hist = train$CoverageField5A==13.0 & train$Field7==23.0 & train$PersonalField27==1.0 & train$PersonalField84==2.0
train$CoverageField5A_Field7_PersonalField27_PropertyField34_hist = train$CoverageField5A==13 & train$Field7==23 & train$PersonalField27==1 & train$PropertyField34=='N'
train$CoverageField5A_Field7_PersonalField27_PropertyField37_hist = train$CoverageField5A==13 & train$Field7==23 & train$PersonalField27==1 & train$PropertyField37=='N'
train$CoverageField5A_Field7_PersonalField27_SalesField5_hist = train$CoverageField5A==13 & train$Field7==23 & train$PersonalField27==1 & train$SalesField5==5
train$CoverageField5A_Field7_PersonalField84_PropertyField34_hist = train$CoverageField5A==13 & train$Field7==23 & train$PersonalField84==2.0 & train$PropertyField34=='N'
train$CoverageField5A_Field7_PersonalField84_PropertyField37_hist = train$CoverageField5A==13 & train$Field7==23 & train$PersonalField84==2.0 & train$PropertyField37=='N'
train$CoverageField5A_Field7_PersonalField84_SalesField5_hist = train$CoverageField5A==13.0 & train$Field7==23.0 & train$PersonalField84==2.0 & train$SalesField5==5.0
train$CoverageField5A_Field7_PropertyField34_PropertyField37_hist = train$CoverageField5A==13 & train$Field7==23 & train$PropertyField34=='N' & train$PropertyField37=='N'
train$CoverageField5A_Field7_PropertyField34_SalesField5_hist = train$CoverageField5A==13 & train$Field7==23 & train$PropertyField34=='N' & train$SalesField5==5
train$CoverageField5A_Field7_PropertyField37_SalesField5_hist = train$CoverageField5A==13 & train$Field7==23 & train$PropertyField37=='N' & train$SalesField5==5
train$CoverageField5A_GeographicField8A_PersonalField27_SalesField5_hist = train$CoverageField5A==13 & train$GeographicField8A==2 & train$PersonalField27==1 & train$SalesField5==5
train$CoverageField5A_GeographicField8A_PropertyField37_SalesField5_hist = train$CoverageField5A==13 & train$GeographicField8A==2 & train$PropertyField37=='N' & train$SalesField5==5
train$CoverageField5A_PersonalField27_PersonalField84_SalesField5_hist = train$CoverageField5A==13.0 & train$PersonalField27==1.0 & train$PersonalField84==2.0 & train$SalesField5==5.0
train$CoverageField5A_PersonalField27_PropertyField34_SalesField5_hist = train$CoverageField5A==13 & train$PersonalField27==0 & train$PropertyField34=='N' & train$SalesField5==5
train$CoverageField5A_PersonalField27_PropertyField34_SalesField5_hist = train$CoverageField5A==13 & train$PersonalField27==1 & train$PropertyField34=='N' & train$SalesField5==5
train$CoverageField5A_PersonalField27_PropertyField37_SalesField5_hist = train$CoverageField5A==13 & train$PersonalField27==0 & train$PropertyField37=='N' & train$SalesField5==5
train$CoverageField5A_PersonalField27_PropertyField37_SalesField5_hist = train$CoverageField5A==13 & train$PersonalField27==1 & train$PropertyField37=='N' & train$SalesField5==5
train$CoverageField5A_PersonalField84_PropertyField34_SalesField5_hist = train$CoverageField5A==13 & train$PersonalField84==2.0 & train$PropertyField34=='N' & train$SalesField5==5
train$CoverageField5A_PersonalField84_PropertyField34_SalesField5_hist = train$CoverageField5A==13 & train$PersonalField84==-1 & train$PropertyField34=='N' & train$SalesField5==5
train$CoverageField5A_PersonalField84_PropertyField37_SalesField5_hist = train$CoverageField5A==13 & train$PersonalField84==2.0 & train$PropertyField37=='N' & train$SalesField5==5
train$CoverageField5A_PersonalField84_PropertyField37_SalesField5_hist = train$CoverageField5A==13 & train$PersonalField84==-1 & train$PropertyField37=='N' & train$SalesField5==5
train$CoverageField5A_PropertyField34_PropertyField37_SalesField5_hist = train$CoverageField5A==13 & train$PropertyField34=='N' & train$PropertyField37=='N' & train$SalesField5==5
train$CoverageField6A_Field7_PersonalField27_PersonalField84_hist = train$CoverageField6A==13.0 & train$Field7==23.0 & train$PersonalField27==1.0 & train$PersonalField84==2.0
train$CoverageField6A_Field7_PersonalField27_PropertyField34_hist = train$CoverageField6A==13 & train$Field7==23 & train$PersonalField27==1 & train$PropertyField34=='N'
train$CoverageField6A_Field7_PersonalField27_PropertyField37_hist = train$CoverageField6A==13 & train$Field7==23 & train$PersonalField27==1 & train$PropertyField37=='N'
train$CoverageField6A_Field7_PersonalField27_SalesField5_hist = train$CoverageField6A==13 & train$Field7==23 & train$PersonalField27==1 & train$SalesField5==5
train$CoverageField6A_Field7_PersonalField84_PropertyField34_hist = train$CoverageField6A==13 & train$Field7==23 & train$PersonalField84==2.0 & train$PropertyField34=='N'
train$CoverageField6A_Field7_PersonalField84_PropertyField37_hist = train$CoverageField6A==13 & train$Field7==23 & train$PersonalField84==2.0 & train$PropertyField37=='N'
train$CoverageField6A_Field7_PersonalField84_SalesField5_hist = train$CoverageField6A==13.0 & train$Field7==23.0 & train$PersonalField84==2.0 & train$SalesField5==5.0
train$CoverageField6A_Field7_PropertyField34_PropertyField37_hist = train$CoverageField6A==13 & train$Field7==23 & train$PropertyField34=='N' & train$PropertyField37=='N'
train$CoverageField6A_Field7_PropertyField34_SalesField5_hist = train$CoverageField6A==13 & train$Field7==23 & train$PropertyField34=='N' & train$SalesField5==5
train$CoverageField6A_Field7_PropertyField37_SalesField5_hist = train$CoverageField6A==13 & train$Field7==23 & train$PropertyField37=='N' & train$SalesField5==5
train$CoverageField6A_GeographicField8A_PersonalField27_SalesField5_hist = train$CoverageField6A==13 & train$GeographicField8A==2 & train$PersonalField27==1 & train$SalesField5==5
train$CoverageField6A_GeographicField8A_PropertyField37_SalesField5_hist = train$CoverageField6A==13 & train$GeographicField8A==2 & train$PropertyField37=='N' & train$SalesField5==5
train$CoverageField6A_PersonalField27_PersonalField84_PropertyField34_hist = train$CoverageField6A==13 & train$PersonalField27==1 & train$PersonalField84==2.0 & train$PropertyField34=='N'
train$CoverageField6A_PersonalField27_PersonalField84_SalesField5_hist = train$CoverageField6A==13.0 & train$PersonalField27==1.0 & train$PersonalField84==2.0 & train$SalesField5==5.0
train$CoverageField6A_PersonalField27_PropertyField34_PropertyField37_hist = train$CoverageField6A==13 & train$PersonalField27==1 & train$PropertyField34=='N' & train$PropertyField37=='N'
train$CoverageField6A_PersonalField27_PropertyField34_SalesField5_hist = train$CoverageField6A==13 & train$PersonalField27==0 & train$PropertyField34=='N' & train$SalesField5==5
train$CoverageField6A_PersonalField27_PropertyField34_SalesField5_hist = train$CoverageField6A==13 & train$PersonalField27==1 & train$PropertyField34=='N' & train$SalesField5==5
train$CoverageField6A_PersonalField27_PropertyField37_SalesField5_hist = train$CoverageField6A==13 & train$PersonalField27==0 & train$PropertyField37=='N' & train$SalesField5==5
train$CoverageField6A_PersonalField27_PropertyField37_SalesField5_hist = train$CoverageField6A==13 & train$PersonalField27==1 & train$PropertyField37=='N' & train$SalesField5==5
train$CoverageField6A_PersonalField84_PropertyField34_PropertyField37_hist = train$CoverageField6A==13 & train$PersonalField84==2.0 & train$PropertyField34=='N' & train$PropertyField37=='N'
train$CoverageField6A_PersonalField84_PropertyField34_SalesField5_hist = train$CoverageField6A==13 & train$PersonalField84==2.0 & train$PropertyField34=='N' & train$SalesField5==5
train$CoverageField6A_PersonalField84_PropertyField34_SalesField5_hist = train$CoverageField6A==13 & train$PersonalField84==-1 & train$PropertyField34=='N' & train$SalesField5==5
train$CoverageField6A_PersonalField84_PropertyField37_SalesField5_hist = train$CoverageField6A==13 & train$PersonalField84==2.0 & train$PropertyField37=='N' & train$SalesField5==5
train$CoverageField6A_PersonalField84_PropertyField37_SalesField5_hist = train$CoverageField6A==13 & train$PersonalField84==-1 & train$PropertyField37=='N' & train$SalesField5==5
train$CoverageField6A_PropertyField34_PropertyField37_SalesField5_hist = train$CoverageField6A==13 & train$PropertyField34=='N' & train$PropertyField37=='N' & train$SalesField5==5
train$Field7_GeographicField8A_PersonalField27_PersonalField84_hist = train$Field7==23.0 & train$GeographicField8A==2.0 & train$PersonalField27==1.0 & train$PersonalField84==2.0
train$Field7_PersonalField27_PersonalField84_PropertyField34_hist = train$Field7==23 & train$PersonalField27==1 & train$PersonalField84==2.0 & train$PropertyField34=='N'
train$Field7_PersonalField27_PersonalField84_PropertyField37_hist = train$Field7==23 & train$PersonalField27==1 & train$PersonalField84==2.0 & train$PropertyField37=='N'
train$Field7_PersonalField27_PersonalField84_SalesField5_hist = train$Field7==23.0 & train$PersonalField27==1.0 & train$PersonalField84==2.0 & train$SalesField5==5.0
train$Field7_PersonalField27_PropertyField34_PropertyField37_hist = train$Field7==23 & train$PersonalField27==1 & train$PropertyField34=='N' & train$PropertyField37=='N'
train$Field7_PersonalField27_PropertyField34_SalesField5_hist = train$Field7==23 & train$PersonalField27==1 & train$PropertyField34=='N' & train$SalesField5==5
train$Field7_PersonalField27_PropertyField37_SalesField5_hist = train$Field7==23 & train$PersonalField27==1 & train$PropertyField37=='N' & train$SalesField5==5
train$Field7_PersonalField84_PropertyField34_PropertyField37_hist = train$Field7==23 & train$PersonalField84==2.0 & train$PropertyField34=='N' & train$PropertyField37=='N'
train$Field7_PersonalField84_PropertyField34_SalesField5_hist = train$Field7==23 & train$PersonalField84==2.0 & train$PropertyField34=='N' & train$SalesField5==5
train$Field7_PersonalField84_PropertyField37_SalesField5_hist = train$Field7==23 & train$PersonalField84==2.0 & train$PropertyField37=='N' & train$SalesField5==5
train$Field7_PropertyField34_PropertyField37_SalesField5_hist = train$Field7==23 & train$PropertyField34=='N' & train$PropertyField37=='N' & train$SalesField5==5
train$GeographicField8A_PersonalField27_PropertyField37_SalesField5_hist = train$GeographicField8A==2 & train$PersonalField27==1 & train$PropertyField37=='N' & train$SalesField5==5
train$PersonalField27_PersonalField84_PropertyField34_SalesField5_hist = train$PersonalField27==0 & train$PersonalField84==-1 & train$PropertyField34=='N' & train$SalesField5==5
train$PersonalField27_PersonalField84_PropertyField34_SalesField5_hist = train$PersonalField27==1 & train$PersonalField84==2.0 & train$PropertyField34=='N' & train$SalesField5==5
train$PersonalField27_PersonalField84_PropertyField37_SalesField5_hist = train$PersonalField27==0 & train$PersonalField84==-1 & train$PropertyField37=='N' & train$SalesField5==5
train$PersonalField27_PersonalField84_PropertyField37_SalesField5_hist = train$PersonalField27==1 & train$PersonalField84==2.0 & train$PropertyField37=='N' & train$SalesField5==5
train$PersonalField27_PropertyField34_PropertyField37_SalesField5_hist = train$PersonalField27==0 & train$PropertyField34=='N' & train$PropertyField37=='N' & train$SalesField5==5
train$PersonalField27_PropertyField34_PropertyField37_SalesField5_hist = train$PersonalField27==1 & train$PropertyField34=='N' & train$PropertyField37=='N' & train$SalesField5==5
train$PersonalField84_PropertyField34_PropertyField37_SalesField5_hist = train$PersonalField84==2.0 & train$PropertyField34=='N' & train$PropertyField37=='N' & train$SalesField5==5
train$PersonalField84_PropertyField34_PropertyField37_SalesField5_hist = train$PersonalField84==-1 & train$PropertyField34=='N' & train$PropertyField37=='N' & train$SalesField5==5
#test
test$CoverageField5A_CoverageField6A_Field7_PersonalField27_hist = test$CoverageField5A==13 & test$CoverageField6A==13 & test$Field7==23 & test$PersonalField27==1
test$CoverageField5A_CoverageField6A_Field7_PersonalField84_hist = test$CoverageField5A==13.0 & test$CoverageField6A==13.0 & test$Field7==23.0 & test$PersonalField84==2.0
test$CoverageField5A_CoverageField6A_Field7_PropertyField34_hist = test$CoverageField5A==13 & test$CoverageField6A==13 & test$Field7==23 & test$PropertyField34=='N'
test$CoverageField5A_CoverageField6A_Field7_PropertyField37_hist = test$CoverageField5A==13 & test$CoverageField6A==13 & test$Field7==23 & test$PropertyField37=='N'
test$CoverageField5A_CoverageField6A_Field7_SalesField5_hist = test$CoverageField5A==13 & test$CoverageField6A==13 & test$Field7==23 & test$SalesField5==5
test$CoverageField5A_CoverageField6A_GeographicField8A_SalesField5_hist = test$CoverageField5A==13 & test$CoverageField6A==13 & test$GeographicField8A==2 & test$SalesField5==5
test$CoverageField5A_CoverageField6A_PersonalField27_PropertyField34_hist = test$CoverageField5A==13 & test$CoverageField6A==13 & test$PersonalField27==1 & test$PropertyField34=='N'
test$CoverageField5A_CoverageField6A_PersonalField27_SalesField5_hist = test$CoverageField5A==13 & test$CoverageField6A==13 & test$PersonalField27==1 & test$SalesField5==5
test$CoverageField5A_CoverageField6A_PersonalField84_PropertyField34_hist = test$CoverageField5A==13 & test$CoverageField6A==13 & test$PersonalField84==2.0 & test$PropertyField34=='N'
test$CoverageField5A_CoverageField6A_PersonalField84_SalesField5_hist = test$CoverageField5A==13.0 & test$CoverageField6A==13.0 & test$PersonalField84==2.0 & test$SalesField5==5.0
test$CoverageField5A_CoverageField6A_PersonalField84_SalesField5_hist = test$CoverageField5A==13.0 & test$CoverageField6A==13.0 & test$PersonalField84==-1 & test$SalesField5==5.0
test$CoverageField5A_CoverageField6A_PropertyField34_PropertyField37_hist = test$CoverageField5A==13 & test$CoverageField6A==13 & test$PropertyField34=='N' & test$PropertyField37=='N'
test$CoverageField5A_CoverageField6A_PropertyField34_SalesField5_hist = test$CoverageField5A==13 & test$CoverageField6A==13 & test$PropertyField34=='N' & test$SalesField5==5
test$CoverageField5A_CoverageField6A_PropertyField37_SalesField5_hist = test$CoverageField5A==13 & test$CoverageField6A==13 & test$PropertyField37=='N' & test$SalesField5==5
test$CoverageField5A_Field7_GeographicField8A_PersonalField27_hist = test$CoverageField5A==13 & test$Field7==23 & test$GeographicField8A==2 & test$PersonalField27==1
test$CoverageField5A_Field7_GeographicField8A_PersonalField84_hist = test$CoverageField5A==13.0 & test$Field7==23.0 & test$GeographicField8A==2.0 & test$PersonalField84==2.0
test$CoverageField5A_Field7_PersonalField27_PersonalField84_hist = test$CoverageField5A==13.0 & test$Field7==23.0 & test$PersonalField27==1.0 & test$PersonalField84==2.0
test$CoverageField5A_Field7_PersonalField27_PropertyField34_hist = test$CoverageField5A==13 & test$Field7==23 & test$PersonalField27==1 & test$PropertyField34=='N'
test$CoverageField5A_Field7_PersonalField27_PropertyField37_hist = test$CoverageField5A==13 & test$Field7==23 & test$PersonalField27==1 & test$PropertyField37=='N'
test$CoverageField5A_Field7_PersonalField27_SalesField5_hist = test$CoverageField5A==13 & test$Field7==23 & test$PersonalField27==1 & test$SalesField5==5
test$CoverageField5A_Field7_PersonalField84_PropertyField34_hist = test$CoverageField5A==13 & test$Field7==23 & test$PersonalField84==2.0 & test$PropertyField34=='N'
test$CoverageField5A_Field7_PersonalField84_PropertyField37_hist = test$CoverageField5A==13 & test$Field7==23 & test$PersonalField84==2.0 & test$PropertyField37=='N'
test$CoverageField5A_Field7_PersonalField84_SalesField5_hist = test$CoverageField5A==13.0 & test$Field7==23.0 & test$PersonalField84==2.0 & test$SalesField5==5.0
test$CoverageField5A_Field7_PropertyField34_PropertyField37_hist = test$CoverageField5A==13 & test$Field7==23 & test$PropertyField34=='N' & test$PropertyField37=='N'
test$CoverageField5A_Field7_PropertyField34_SalesField5_hist = test$CoverageField5A==13 & test$Field7==23 & test$PropertyField34=='N' & test$SalesField5==5
test$CoverageField5A_Field7_PropertyField37_SalesField5_hist = test$CoverageField5A==13 & test$Field7==23 & test$PropertyField37=='N' & test$SalesField5==5
test$CoverageField5A_GeographicField8A_PersonalField27_SalesField5_hist = test$CoverageField5A==13 & test$GeographicField8A==2 & test$PersonalField27==1 & test$SalesField5==5
test$CoverageField5A_GeographicField8A_PropertyField37_SalesField5_hist = test$CoverageField5A==13 & test$GeographicField8A==2 & test$PropertyField37=='N' & test$SalesField5==5
test$CoverageField5A_PersonalField27_PersonalField84_SalesField5_hist = test$CoverageField5A==13.0 & test$PersonalField27==1.0 & test$PersonalField84==2.0 & test$SalesField5==5.0
test$CoverageField5A_PersonalField27_PropertyField34_SalesField5_hist = test$CoverageField5A==13 & test$PersonalField27==0 & test$PropertyField34=='N' & test$SalesField5==5
test$CoverageField5A_PersonalField27_PropertyField34_SalesField5_hist = test$CoverageField5A==13 & test$PersonalField27==1 & test$PropertyField34=='N' & test$SalesField5==5
test$CoverageField5A_PersonalField27_PropertyField37_SalesField5_hist = test$CoverageField5A==13 & test$PersonalField27==0 & test$PropertyField37=='N' & test$SalesField5==5
test$CoverageField5A_PersonalField27_PropertyField37_SalesField5_hist = test$CoverageField5A==13 & test$PersonalField27==1 & test$PropertyField37=='N' & test$SalesField5==5
test$CoverageField5A_PersonalField84_PropertyField34_SalesField5_hist = test$CoverageField5A==13 & test$PersonalField84==2.0 & test$PropertyField34=='N' & test$SalesField5==5
test$CoverageField5A_PersonalField84_PropertyField34_SalesField5_hist = test$CoverageField5A==13 & test$PersonalField84==-1 & test$PropertyField34=='N' & test$SalesField5==5
test$CoverageField5A_PersonalField84_PropertyField37_SalesField5_hist = test$CoverageField5A==13 & test$PersonalField84==2.0 & test$PropertyField37=='N' & test$SalesField5==5
test$CoverageField5A_PersonalField84_PropertyField37_SalesField5_hist = test$CoverageField5A==13 & test$PersonalField84==-1 & test$PropertyField37=='N' & test$SalesField5==5
test$CoverageField5A_PropertyField34_PropertyField37_SalesField5_hist = test$CoverageField5A==13 & test$PropertyField34=='N' & test$PropertyField37=='N' & test$SalesField5==5
test$CoverageField6A_Field7_PersonalField27_PersonalField84_hist = test$CoverageField6A==13.0 & test$Field7==23.0 & test$PersonalField27==1.0 & test$PersonalField84==2.0
test$CoverageField6A_Field7_PersonalField27_PropertyField34_hist = test$CoverageField6A==13 & test$Field7==23 & test$PersonalField27==1 & test$PropertyField34=='N'
test$CoverageField6A_Field7_PersonalField27_PropertyField37_hist = test$CoverageField6A==13 & test$Field7==23 & test$PersonalField27==1 & test$PropertyField37=='N'
test$CoverageField6A_Field7_PersonalField27_SalesField5_hist = test$CoverageField6A==13 & test$Field7==23 & test$PersonalField27==1 & test$SalesField5==5
test$CoverageField6A_Field7_PersonalField84_PropertyField34_hist = test$CoverageField6A==13 & test$Field7==23 & test$PersonalField84==2.0 & test$PropertyField34=='N'
test$CoverageField6A_Field7_PersonalField84_PropertyField37_hist = test$CoverageField6A==13 & test$Field7==23 & test$PersonalField84==2.0 & test$PropertyField37=='N'
test$CoverageField6A_Field7_PersonalField84_SalesField5_hist = test$CoverageField6A==13.0 & test$Field7==23.0 & test$PersonalField84==2.0 & test$SalesField5==5.0
test$CoverageField6A_Field7_PropertyField34_PropertyField37_hist = test$CoverageField6A==13 & test$Field7==23 & test$PropertyField34=='N' & test$PropertyField37=='N'
test$CoverageField6A_Field7_PropertyField34_SalesField5_hist = test$CoverageField6A==13 & test$Field7==23 & test$PropertyField34=='N' & test$SalesField5==5
test$CoverageField6A_Field7_PropertyField37_SalesField5_hist = test$CoverageField6A==13 & test$Field7==23 & test$PropertyField37=='N' & test$SalesField5==5
test$CoverageField6A_GeographicField8A_PersonalField27_SalesField5_hist = test$CoverageField6A==13 & test$GeographicField8A==2 & test$PersonalField27==1 & test$SalesField5==5
test$CoverageField6A_GeographicField8A_PropertyField37_SalesField5_hist = test$CoverageField6A==13 & test$GeographicField8A==2 & test$PropertyField37=='N' & test$SalesField5==5
test$CoverageField6A_PersonalField27_PersonalField84_PropertyField34_hist = test$CoverageField6A==13 & test$PersonalField27==1 & test$PersonalField84==2.0 & test$PropertyField34=='N'
test$CoverageField6A_PersonalField27_PersonalField84_SalesField5_hist = test$CoverageField6A==13.0 & test$PersonalField27==1.0 & test$PersonalField84==2.0 & test$SalesField5==5.0
test$CoverageField6A_PersonalField27_PropertyField34_PropertyField37_hist = test$CoverageField6A==13 & test$PersonalField27==1 & test$PropertyField34=='N' & test$PropertyField37=='N'
test$CoverageField6A_PersonalField27_PropertyField34_SalesField5_hist = test$CoverageField6A==13 & test$PersonalField27==0 & test$PropertyField34=='N' & test$SalesField5==5
test$CoverageField6A_PersonalField27_PropertyField34_SalesField5_hist = test$CoverageField6A==13 & test$PersonalField27==1 & test$PropertyField34=='N' & test$SalesField5==5
test$CoverageField6A_PersonalField27_PropertyField37_SalesField5_hist = test$CoverageField6A==13 & test$PersonalField27==0 & test$PropertyField37=='N' & test$SalesField5==5
test$CoverageField6A_PersonalField27_PropertyField37_SalesField5_hist = test$CoverageField6A==13 & test$PersonalField27==1 & test$PropertyField37=='N' & test$SalesField5==5
test$CoverageField6A_PersonalField84_PropertyField34_PropertyField37_hist = test$CoverageField6A==13 & test$PersonalField84==2.0 & test$PropertyField34=='N' & test$PropertyField37=='N'
test$CoverageField6A_PersonalField84_PropertyField34_SalesField5_hist = test$CoverageField6A==13 & test$PersonalField84==2.0 & test$PropertyField34=='N' & test$SalesField5==5
test$CoverageField6A_PersonalField84_PropertyField34_SalesField5_hist = test$CoverageField6A==13 & test$PersonalField84==-1 & test$PropertyField34=='N' & test$SalesField5==5
test$CoverageField6A_PersonalField84_PropertyField37_SalesField5_hist = test$CoverageField6A==13 & test$PersonalField84==2.0 & test$PropertyField37=='N' & test$SalesField5==5
test$CoverageField6A_PersonalField84_PropertyField37_SalesField5_hist = test$CoverageField6A==13 & test$PersonalField84==-1 & test$PropertyField37=='N' & test$SalesField5==5
test$CoverageField6A_PropertyField34_PropertyField37_SalesField5_hist = test$CoverageField6A==13 & test$PropertyField34=='N' & test$PropertyField37=='N' & test$SalesField5==5
test$Field7_GeographicField8A_PersonalField27_PersonalField84_hist = test$Field7==23.0 & test$GeographicField8A==2.0 & test$PersonalField27==1.0 & test$PersonalField84==2.0
test$Field7_PersonalField27_PersonalField84_PropertyField34_hist = test$Field7==23 & test$PersonalField27==1 & test$PersonalField84==2.0 & test$PropertyField34=='N'
test$Field7_PersonalField27_PersonalField84_PropertyField37_hist = test$Field7==23 & test$PersonalField27==1 & test$PersonalField84==2.0 & test$PropertyField37=='N'
test$Field7_PersonalField27_PersonalField84_SalesField5_hist = test$Field7==23.0 & test$PersonalField27==1.0 & test$PersonalField84==2.0 & test$SalesField5==5.0
test$Field7_PersonalField27_PropertyField34_PropertyField37_hist = test$Field7==23 & test$PersonalField27==1 & test$PropertyField34=='N' & test$PropertyField37=='N'
test$Field7_PersonalField27_PropertyField34_SalesField5_hist = test$Field7==23 & test$PersonalField27==1 & test$PropertyField34=='N' & test$SalesField5==5
test$Field7_PersonalField27_PropertyField37_SalesField5_hist = test$Field7==23 & test$PersonalField27==1 & test$PropertyField37=='N' & test$SalesField5==5
test$Field7_PersonalField84_PropertyField34_PropertyField37_hist = test$Field7==23 & test$PersonalField84==2.0 & test$PropertyField34=='N' & test$PropertyField37=='N'
test$Field7_PersonalField84_PropertyField34_SalesField5_hist = test$Field7==23 & test$PersonalField84==2.0 & test$PropertyField34=='N' & test$SalesField5==5
test$Field7_PersonalField84_PropertyField37_SalesField5_hist = test$Field7==23 & test$PersonalField84==2.0 & test$PropertyField37=='N' & test$SalesField5==5
test$Field7_PropertyField34_PropertyField37_SalesField5_hist = test$Field7==23 & test$PropertyField34=='N' & test$PropertyField37=='N' & test$SalesField5==5
test$GeographicField8A_PersonalField27_PropertyField37_SalesField5_hist = test$GeographicField8A==2 & test$PersonalField27==1 & test$PropertyField37=='N' & test$SalesField5==5
test$PersonalField27_PersonalField84_PropertyField34_SalesField5_hist = test$PersonalField27==0 & test$PersonalField84==-1 & test$PropertyField34=='N' & test$SalesField5==5
test$PersonalField27_PersonalField84_PropertyField34_SalesField5_hist = test$PersonalField27==1 & test$PersonalField84==2.0 & test$PropertyField34=='N' & test$SalesField5==5
test$PersonalField27_PersonalField84_PropertyField37_SalesField5_hist = test$PersonalField27==0 & test$PersonalField84==-1 & test$PropertyField37=='N' & test$SalesField5==5
test$PersonalField27_PersonalField84_PropertyField37_SalesField5_hist = test$PersonalField27==1 & test$PersonalField84==2.0 & test$PropertyField37=='N' & test$SalesField5==5
test$PersonalField27_PropertyField34_PropertyField37_SalesField5_hist = test$PersonalField27==0 & test$PropertyField34=='N' & test$PropertyField37=='N' & test$SalesField5==5
test$PersonalField27_PropertyField34_PropertyField37_SalesField5_hist = test$PersonalField27==1 & test$PropertyField34=='N' & test$PropertyField37=='N' & test$SalesField5==5
test$PersonalField84_PropertyField34_PropertyField37_SalesField5_hist = test$PersonalField84==2.0 & test$PropertyField34=='N' & test$PropertyField37=='N' & test$SalesField5==5
test$PersonalField84_PropertyField34_PropertyField37_SalesField5_hist = test$PersonalField84==-1 & test$PropertyField34=='N' & test$PropertyField37=='N' & test$SalesField5==5
#one hot encode
full = rbind(train[, -which(names(train) %in% c("QuoteConversion_Flag"))],test)
temp = subset(full, select = c(Field6,Field12
,CoverageField8,CoverageField9
,SalesField7
,PersonalField7,PersonalField16
,PersonalField17,PersonalField18
,PersonalField19,PropertyField3
,PropertyField4,PropertyField5
,PropertyField30,PropertyField32
,PropertyField7,PropertyField14
,PropertyField28,PropertyField31
,PropertyField33,PropertyField34
,PropertyField36,PropertyField36
,PropertyField38
,GeographicField64,GeographicField63
#,CoverageField8_GeographicField64
#,CoverageField9_PersonalField16
#,CoverageField9_PersonalField19
#,PropertyField28_day
#,CoverageField8_CoverageField9
#,CoverageField8_PropertyField31
#,PersonalField16_PersonalField17
#,PersonalField16_PersonalField18
#,PersonalField17_month
,SalesField7_month
#,PersonalField16_day
#,PersonalField16_PersonalField19
#,PropertyField31_day
#,PersonalField18_month
#,PersonalField16_month
,month_day
))
temp_sparse = sparse.model.matrix(~ -1 + Field6+Field12
+CoverageField8+CoverageField9
+SalesField7
+PersonalField7+PersonalField16
+PersonalField17+PersonalField18
+PersonalField19+PropertyField3
+PropertyField4+PropertyField5
+PropertyField30+PropertyField32
+PropertyField7+PropertyField14
+PropertyField28+PropertyField31
+PropertyField33+PropertyField34
+PropertyField36+PropertyField36
+PropertyField38
+GeographicField64+GeographicField63
#+CoverageField8_GeographicField64
#+CoverageField9_PersonalField16
#+CoverageField9_PersonalField19
#+PropertyField28_day
#+CoverageField8_CoverageField9
#+CoverageField8_PropertyField31
#+PersonalField16_PersonalField17
#+PersonalField16_PersonalField18
#+PersonalField17_month
+SalesField7_month
#+PersonalField16_day
#+PersonalField16_PersonalField19
#+PropertyField31_day
#+PersonalField18_month
#+PersonalField16_month
+month_day
, temp)
temp_sparse = as.data.frame(as.matrix(temp_sparse))
train.sparse = temp_sparse[1:nrow(train),]
ntest = nrow(train) + 1
test.sparse = temp_sparse[ntest:nrow(temp_sparse),]
train = cbind(train,train.sparse)
test = cbind(test,test.sparse)
rm(full)
rm(temp_sparse)
gc()
cat("reading other 2gram features\n")
train_2gram <- read_csv("../data/train_2gram.csv")
train = merge(train, train_2gram, 'QuoteNumber')
rm(train_2gram)
test_2gram <- read_csv("../data/test_2gram.csv")
test = merge(test, test_2gram, 'QuoteNumber')
rm(test_2gram)
gc()
feature.names <- names(train)[-which(names(train) %in% c("QuoteNumber","QuoteConversion_Flag" )) ]
cat("assuming text variables are categorical & replacing them with numeric ids\n")
for (f in feature.names) {
if (class(train[[f]])=="character") {
levels <- unique(c(train[[f]], test[[f]]))
train[[f]] <- as.integer(factor(train[[f]], levels=levels))
test[[f]]  <- as.integer(factor(test[[f]],  levels=levels))
}
}
cat("train data column names after slight feature engineering\n")
length(names(train))
cat("test data column names after slight feature engineering\n")
length(names(test))
library(caret)
install.packages("pbkrtest")
load("~/GitHub/riotinto.conditioninsight.algorithms/data/data.RData")
truckID = 'T401'
data_one_truck = subset(data,UnitName == truckID)
break_by_para <- split( data_one_truck , f = data_one_truck$Parameter )
rm(data)
gc()
length(break_by_para)
apply(break_by_para,length)
lapply(break_by_para,length)
nrow(break_by_para)
nrow(break_by_para)
nrow(break_by_para$`Accelerator Pedal`)
lapply(break_by_para,nrow)
a = apply(break_by_para,nrow)
a = lapply(break_by_para,nrow)
a = as.data.frame(a)
a = as.array(a)
a = lapply(break_by_para,nrow)
a = unlist(a)
a
plot(a)
head(break_by_para$`Accelerator Pedal`)
head(break_by_para$`Engine Speed`)
head(break_by_para$`Engine Speed`,n=100)
tail(break_by_para$`Engine Speed`,n=100)
dim(break_by_para$`Engine Speed`)
sum(a)
head(break_by_para$`Engine Speed`,n=100)
tail(break_by_para$`Engine Speed`,n=100)
load("~/GitHub/riotinto.conditioninsight.algorithms/data/data.RData")
T401_break_by_para = break_by_para
rm(data_one_truck)
gc()
rm(break_by_para)
gc()
truckID = 'T408'
data_one_truck = subset(data,UnitName == truckID)
break_by_para <- split( data_one_truck , f = data_one_truck$Parameter )
head(break_by_para$`Engine Speed`)
head(break_by_para$`Engine Speed`,n=100)
head(T401_break_by_para$`Engine Speed`,n=100)
tail(break_by_para$`Engine Speed`)
tail(break_by_para$`Engine Speed`,n=50)
tail(T401_break_by_para$`Engine Speed`,n=50)
nrow(T401_break_by_para$`Engine Speed`)
nrow(break_by_para$`Engine Speed`)
tail(T401_break_by_para$`Engine Speed`)
T401_break_by_para$`Engine Speed`[1:100,]
T401_break_by_para$`Engine Speed`[1000:1100,]
dim(break_by_para)
size(break_by_para)
length(break_by_para)
length(T401_break_by_para)
length(T401_break_by_para$`Ambient Air Pressure`)
size(T401_break_by_para$`Ambient Air Pressure`)
dim(T401_break_by_para$`Ambient Air Pressure`)
dim(break_by_para$`Ambient Air Pressure`)
head(break_by_para$`Ambient Air Pressure`)
tail(break_by_para$`Ambient Air Pressure`)
head(T401_break_by_para$`Ambient Air Pressure`)
tail(T401_break_by_para$`Ambient Air Pressure`)
T401_break_by_para$`Ambient Air Pressure`[100000:100050]
T401_break_by_para$`Ambient Air Pressure`[100000:100050,]
head(T401_break_by_para$`Ambient Air Pressure`)
tail(T401_break_by_para$`Ambient Air Pressure`)
T401_break_by_para$`Ambient Air Pressure`[100000:100050,]
install.packages("mxnet")
install.packages("drat", repos="https://cran.rstudio.com")
drat:::addRepo("dmlc")
install.packages("mxnet")
install.packages("shiny", repos="https://cran.rstudio.com")
install.packages("imager", repos="https://cran.rstudio.com")
shiny::runGitHub("thirdwing/mxnet_shiny")
shiny::runGitHub("thirdwing/mxnet_shiny")
shiny::runGitHub("thirdwing/mxnet_shiny")
## ==============================
## Load packages
## ==============================
## These packages are available from CRAN
library(jpeg)
library(randomForest)
library(readr)
rm(list = ls())
gc()
## ==============================
## Main variables
## ==============================
setwd('E:/02.DS competitions/Yelp/R')
## Set the path to your data here
data_dir <- "../input"
train_data_dir <- paste(data_dir,"/train_photos", sep="")
test_data_dir <- paste(data_dir,"/test_photos", sep="")
## ==============================
## Define Functions
## ==============================
## Handy function to display a greyscale image of the plankton
im <- function(image) image(image, col = grey.colors(32))
## Function to extract some simple statistics about the image
## UPDATE THIS to do any calculations that you think are useful
extract_stats <- function(working_image = working_image){
im_length <- nrow(working_image)
im_width <- ncol(working_image)
im_density <- mean(working_image)
im_ratio <- im_length / im_width
im_df = as.data.frame(cbind(length=im_length,width=im_width,density=im_density,ratio=im_ratio))
return(im_df)
#   #Invert the image to calculate density
#   statsR = summary(as.vector(working_image[,,1]))
#   names(statsR) = paste0(names(statsR),'R')
#   statsG = summary(as.vector(working_image[,,2]))
#   names(statsG) = paste0(names(statsG),'G')
#   statsB = summary(as.vector(working_image[,,3]))
#   names(statsB) = paste0(names(statsB),'B')
#   return(as.data.frame(c(im_df,statsR,statsG,statsB)))
#   nBins = 10
#   histR =hist(working_image[,,1],breaks=seq(0,1,1/nBins),plot = F)$density/nBins
#   names(histR) = paste0('histR_',1:nBins)
#   histG =hist(working_image[,,2],breaks=seq(0,1,1/nBins),plot = F)$density/nBins
#   names(histG) = paste0('histG_',1:nBins)
#   histB =hist(working_image[,,3],breaks=seq(0,1,1/nBins),plot = F)$density/nBins
#   names(histB) = paste0('histB_',1:nBins)
#   return(as.data.frame(c(im_df,statsR,statsG,statsB,histR,histG,histB)))
}
## Function to calculate multi-class loss on train data
mcloss <- function (y_actual, y_pred) {
dat <- rep(0, length(y_actual))
for(i in 1:length(y_actual)){
dat_x <- y_pred[i,y_actual[i]]
dat[i] <- min(1-1e-15,max(1e-15,dat_x))
}
return(-sum(log(dat))/length(y_actual))
}
## ==============================
## Read training data
## ==============================
load('../input/file_list.RData')
#
test_file_list <- list.files(test_data_dir)
save(train_file_list,test_file_list, file = '../input/file_list.RData')
feature_engineering <- function(feature_file_name,file_dir, file_list){
feature_data <- c()
idx <- 1
startT <- Sys.time()
#Read and process each image
cat('Read and process each image\n')
for(fileID in train_file_list){
working_file <- paste(file_dir,"/",fileID,sep="")
working_image <- readJPEG(working_file)
#View image
#   if (exists("rasterImage")) { # can plot only in R 2.11.0 and higher
#     temp = max(ncol(working_image),nrow(working_image))
#     plot(0:temp,0:temp, type='n')
#     rasterImage(working_image, 0, 0, nrow(working_image), ncol(working_image))
#   }
# Calculate model statistics
## YOUR CODE HERE ##
working_stats <- extract_stats(working_image)
working_summary <- data.frame(fileName = fileID,working_stats)
if(is.null(feature_data)){
feature_data <- data.frame(temp = rep("",length(train_file_list)), working_summary, stringsAsFactors = FALSE)
feature_data$temp = NULL
}else{
feature_data[idx,] <- working_summary
}
idx <- idx + 1
if(idx %% 1000 ==0){
cat('Processed ', idx, ', time: ',Sys.time() - startT,'\n')
if(idx %% 10000 ==0){
save(feature_data,file = paste0('../input/', feature_file_name,'.RData'))
}
}
}
cat("Finished processing train data", '\n')
}
feature_engineering('test_feature',test_data_dir,test_file_list)
test_file_list[1]
test_file_list[10]
test_file_list[9]
test_file_list[2]
test_file_list[1]
feature_engineering <- function(feature_file_name,file_dir, file_list){
feature_data <- c()
idx <- 1
startT <- Sys.time()
#Read and process each image
cat('Read and process each image\n')
for(fileID in file_list){
working_file <- paste(file_dir,"/",fileID,sep="")
working_image <- readJPEG(working_file)
#View image
#   if (exists("rasterImage")) { # can plot only in R 2.11.0 and higher
#     temp = max(ncol(working_image),nrow(working_image))
#     plot(0:temp,0:temp, type='n')
#     rasterImage(working_image, 0, 0, nrow(working_image), ncol(working_image))
#   }
# Calculate model statistics
## YOUR CODE HERE ##
working_stats <- extract_stats(working_image)
working_summary <- data.frame(fileName = fileID,working_stats)
if(is.null(feature_data)){
feature_data <- data.frame(temp = rep("",length(file_list)), working_summary, stringsAsFactors = FALSE)
feature_data$temp = NULL
}else{
feature_data[idx,] <- working_summary
}
idx <- idx + 1
if(idx %% 1000 ==0){
cat('Processed ', idx, ', time: ',Sys.time() - startT,'\n')
if(idx %% 10000 ==0){
save(feature_data,file = paste0('../input/', feature_file_name,'.RData'))
}
}
}
cat("Finished processing train data", '\n')
}
feature_engineering('test_feature',test_data_dir,test_file_list)
train_freq = summary(train$freq)
train_freq= train_freq[c(1:3,5:6)]
save(feature_data,file = paste0('../input/', feature_file_name,'.RData'))
